## 详细设计文档

# 目录

1. 引言
2. 产品概述
3. 体系结构设计概述
4. 结构视角



### 1. 引言

#### 1.1 编制目的

详细完成对电影管理系统的详细设计

### 2.产品概述
参考用例文档和软件需求规格说明文档中对产品的概括描述

### 3.体系结构设计概述
参考概要设计文档中对体系结构设计的概述

### 4.结构视角

#### 4.1 业务逻辑层的分解

##### 4.1.1  user模块
（1）模块功能

负责实现登录界面需要的功能以及对用户进行增删改查,详情参见需求文档

（2）整体设计图

![](C:\Users\msSsa\Downloads\User.png)

（3）



##### 4.1.2 sale模块

（1）模块功能

负责实现用户购票,查看票据,退票以及管理员对退票策略的功能,详情参见需求文档

（2）整体设计图

![](C:\Users\msSsa\Downloads\ticket.png)

（3）

<center>TicketController接口规范<center>

| 提供的服务                                |                                                              |
| ----------------------------------------- | ------------------------------------------------------------ |
| buyTicket(TicketsWithCouponForm)          | 语法：       public ResponseVO buyTicket(TicketsWithCouponForm ticketsWithCouponForm)<br/>前置条件：无<br/>后置条件：调用TicketService的completeTicket方法 |
| buyTicketByVIPCard(TicketsWithCouponForm) | 语法：       public ResponseVO buyTicketByVIPCard(TicketsWithCouponForm ticketsWithCouponForm)<br/>前置条件：无<br/>后置条件：调用TicketService的completeByVIPCard方法 |
| lockSeat(TicketForm)                      | 语法：       public ResponseVO lockSeat(TicketForm ticketForm)<br/>前置条件：无<br/>后置条件：调用TicketService的addTicket方法 |
| getTicketOrderByUserId<br/>(int)          | 语法：       public ResponseVO getTicketOrderByUserId(int userId)<br/>前置条件：无<br/>后置条件：调用TicketService的getTicketByUser方法 |
| getSaleHistory(int)                       | 语法：       public ResponseVO getSaleHistory(int userId)<br/>前置条件：无<br/>后置条件：调用TicketService的getSaleHistory方法 |
| getOccupiedSeats(int)                     | 语法：       public ResponseVO getOccupiedSeats(int scheduleId)<br/>前置条件：无<br/>后置条件：调用TicketService的getBySchedule方法 |
| cancelTicket( List<Integer>)              | 语法：       public ResponseVO cancelTicket( List<Integer> ticketId)<br/>前置条件：无<br/>后置条件：调用TicketService的cancelTicket方法 |
| addRefund(TicketRefundVO)                 | 语法：       public ResponseVO addRefund(TicketRefundVO ticketRefundVO)<br/>前置条件：无<br/>后置条件：调用TicketService的addRefund方法 |
| updateRefund(TicketRefundVO)              | 语法：       public ResponseVO updateRefund(TicketRefundVO ticketRefundVO)<br/>前置条件：无<br/>后置条件：调用TicketService的updateRefund方法 |
| getRefund()                               | 语法：       public ResponseVO getRefund()<br/>前置条件：无<br/>后置条件：调用TicketService的getRefundInfo方法 |
| refundById(List<Integer>)                 | 语法：       public ResponseVO refundById(List<Integer> idList)<br/>前置条件：无<br/>后置条件：调用TicketService的refundById方法 |
| getUserByConsume(double)                  | 语法：       public ResponseVO getUserByConsume(double consume)<br/>前置条件：无<br/>后置条件：调用TicketService的getUserByConsume方法 |
| **需要的服务(需接口)**                    |                                                              |
| addTicket                                 | 添加订单和票据                                               |
| completeTicket                            | 更新订单和票据                                               |
| completeByVIPCard                         | 更新订单和票据以及用户信息                                   |
| cancelTicket                              | 取消锁座                                                     |
| getBySchedule                             | 获得座次信息                                                 |
| getTicketByUser                           | 获得订单信息                                                 |
| addRefund                                 | 添加一个退票策略                                             |
| updateRefund                              | 更新退票策略                                                 |
| getRefundInfo                             | 获得退票策略                                                 |
| getSaleHistory                            | 获得票据信息                                                 |
| refundById                                | 取消订单                                                     |
| getUserByConsume                          | 筛选金额达到指定数据的用户                                   |

<center>TicketServiceImpl模块的接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| Sales.TicketService.addTicket                                | 语法：        ResponseVO addTicket(TicketForm ticketForm);<br/>前置条件：观众已登录<br/>后置条件：更新观众的订单信息 |
| Sales.TicketService.completeTicket                           | 语法：        ResponseVO completeTicket(TicketsWithCouponForm ticketsWithCouponForm);<br/>前置条件：观众已登录<br/>后置条件：判断是否成功 |
| Sales.TicketService.completeByVIPCard                        | 语法：        ResponseVO completeByVIPCard(TicketsWithCouponForm ticketsWithCouponForm);<br/>前置条件：观众已登录<br/>后置条件：判断是否成功 |
| Sales.TicketService.cancelTicket                             | 语法：        ResponseVO cancelTicket(List<Integer> id);<br/>前置条件：观众已登录<br/>后置条件：更新观众的订单信息 |
| Sales.TicketService.getBySchedule                            | 语法：       ResponseVO getBySchedule(int scheduleId);<br/>前置条件：观众已登录<br/>后置条件：返回相关信息 |
| Sales.TicketService.getTicketByUser                          | 语法：        ResponseVO getTicketByUser(int userId);<br/>前置条件：观众已登录<br/>后置条件：返回相关信息 |
| Sales.TicketService.addRefund                                | 语法：        ResponseVO addRefund(TicketRefundVO ticketRefundVO);<br/>前置条件：观众已登录<br/>后置条件：更新观众的订单信息 |
| Sales.TicketService.updateRefund                             | 语法：        ResponseVO updateRefund(TicketRefundVO ticketRefundVO);<br/>前置条件：观众已登录<br/>后置条件：更新观众的订单信息 |
| Sales.TicketService.getRefundInfo                            | 语法：       ResponseVO getRefundInfo();<br/>前置条件：观众已登录<br/>后置条件：返回相关信息 |
| Sales.TicketService.getSaleHistory                           | 语法：       ResponseVO getSaleHistory(int userId);<br/>前置条件：观众已登录<br/>后置条件：返回相关信息 |
| Sales.TicketService.refundById                               | 语法：       ResponseVO refundById(List<Integer> idList);<br/>前置条件：观众已登录<br/>后置条件：返回相关信息 |
| Sales.TicketService.getUserByConsume                         | 语法：       ResponseVO getUserByConsume(double consume);<br/>前置条件：观众已登录<br/>后置条件：返回相关信息 |
|                                                              |                                                              |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| data.sales.TicketMapper.insertTicket(Ticket ticket);         | 插入单一持久化对象                                           |
| data.sales.TicketMapper.updateTicketState( int ticketId, int state); | 更新单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketsBySchedule(int scheduleId); | 查找单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketByScheduleIdAndSeat( int scheduleId,  int columnIndex,  int rowIndex); | 查找单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketById(int id);            | 查找单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketByUser(int userId);      | 得到Manage数据库的服务的引用                                 |
| data.sales.TicketMapper.insertTicketRefund(TicketRefund ticketRefund); | 插入单一持久化对象                                           |
| data.sales.TicketMapper.updateTicketRefund(Double rate, Integer limitHours); | 更新单一持久化对象                                           |
| data.sales.TicketMapper.selectRefundInfo();                  | 选择单一持久化对象                                           |
| data.sales.TicketMapper.insertTicketOrder(TicketOrder ticketOrder); | 插入单一持久化对象                                           |
| data.sales.TicketMapper.updateTicketOrder( Integer couponId,  Integer ticketId); | 更新单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketOrdersByUserId(int userId); | 选择单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketOrderById(Integer id);   | 选择单一持久化对象                                           |
|                                                              |                                                              |

##### 4.1.3 admin模块

(1)模块功能

详情参见需求文档

![](C:\Users\msSsa\Downloads\admin.png)

(3)
<center>AccountController接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| searchAllAdminAccount()                                      | 语法：       public ResponseVO searchAllAdminAccount()<br/>前置条件：无<br/>后置条件：调用AdminService领域对象的searchAllAdminAccount()方法 |
| addAdminAccount(UserForm)                                    | 语法：       public ResponseVO addAdminAccount(UserForm userForm)<br/>前置条件：无<br/>后置条件：调用AdminService领域对象的adminService.<br/>addAdminAccount(userForm)方法 |
| changeAdminAccount(UserForm)                                 | 语法：       public ResponseVO changeAdminAccount(AdminForm adminForm)<br/>前置条件：无<br/>后置条件：调用AdminService领域对象的changeAdminAccount(adminForm)方法 |
| deleteAdminAccount<br/>(AccountBatchDeleteForm)              | 语法：       public ResponseVO deleteAdminAccount(AccountBatchDeleteForm accountBatchDeleteForm)<br/>前置条件：无<br/>后置条件：调用AdminService领域对象的deleteAdminAccount(accountBatchDeleteForm)方法 |
| **需要的服务(需接口)**                                       |                                                              |
| adminService.<br/>searchAllAdminAccount()                    | 查询所有员工信息                                             |
| adminService.<br/>addAdminAccount(userForm)                  | 添加一条员工信息                                             |
| adminService.<br>changeAdminAccount(adminForm)               | 修改员工信息                                                 |
| adminService.<br/>deleteAdminAccount(accountBatchDeleteForm) | 删除员工信息                                                 |

<center>AdminServiceImpl的接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| management.AdminService.selectAllAdminAccount                | 语法：       ResponseVO searchAllAdminAccount();<br/>前置条件：能够检索到数据库<br/>后置条件：查找数据库返回所有员工账号信息，没有则提示无结果 |
| managemen.AdminService.addAdminAccount                       | 语法：        ResponseVO addAdminAccount(UserForm userForm);<br/>前置条件：管理员已登录<br/>后置条件：更新员工账号数据 |
| management.AdminService.changeAdminAccount                   | 语法：        ResponseVO changeAdminAccount(AdminForm adminForm);<br/>前置条件：管理员已登录<br/>后置条件：更新员工的数据 |
| management.AdminService.deleteAdminAccount                   | 语法：        ResponseVO deleteAdminAccount(AccountBatchDeleteForm accountBatchDeleteForm);<br/>前置条件：管理员已登录<br/>后置条件：更新员工的数据 |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| data.management.AdminMapper.selectAllAdminAccount()          | 查找持久化对象                                               |
| data.management.AdminMapper.addAdminAccount( String username,  String password); | 插入单一持久化对象                                           |
| data.management.AdminMapper.changeAdminAccount( int id, String username, String password); | 更新单一持久化对象                                           |
| data.management.AdminMapper.deleteAdminAccount( int id);     | 删除单一持久化对象            |

##### 4.1.4 hall模块

(1)模块功能

详情参见需求文档

(2)整体设计图
![](C:\Users\msSsa\Downloads\hall.png)

(3)
<center>HallController接口规范<center>


| 提供的服务                            |                                                              |
| ------------------------------------- | ------------------------------------------------------------ |
| management.HallService.searchAllHall                         | 语法：        ResponseVO searchAllHall();<br/>前置条件：管理员已登录<br/>后置条件：更新影厅的数据 |
|management.HallService.addHall                                | 语法：        ResponseVO addHall(HallForm hallForm);<br/>前置条件：管理员已登录<br/>后置条件：更新影厅的数据 |
| management.HallService.changeHall                            | 语法：        ResponseVO changeHall(HallForm hallForm);<br/>前置条件：管理员已登录<br/> 后置条件：更新影厅的数据 |
| management.HallService.deleteHall                            | 语法：        ResponseVO deleteHall(HallForm hallForm);<br/>前置条件：管理员已登录<br/> 后置条件：更新影厅的数据 |
| **需要的服务(需接口)**                |                                                              |
| HallService.<br/>searchAllHall()      | 查询所有影厅信息                                             |
| HallService.<br/>addHall(HallForm)    | 添加一条影厅信息                                             |
| HallService.<br>changeHall(HallForm)  | 修改影厅信息                                                 |
| HallService.<br/>deleteHall(HallForm) | 删除影厅信息                                                 |

<center>HallServiceImpl的接口规范<center>

| **提供的服务**                                                |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| searchAllHall()                       | 语法：       public ResponseVO searchAllHall()<br/>前置条件：无<br/>后置条件：调用HallService领域对象的searchAllHall()方法 |
| addHall(HallForm)                     | 语法：       public ResponseVO addHall(HallForm hallForm)<br/>前置条件：无<br/>后置条件：调用HallService领域对象的HallService.addHall(hallForm)方法 |
| changeHall(HallForm)                  | 语法：       public ResponseVO changeHall(HallForm hallForm)<br/>前置条件：无<br/>后置条件：调用HallService领域对象的changeHall(hallForm)方法 |
| **需要的服务**                            |                                                              |
| deleteHall<br/>(HallForm)             | 语法：       public ResponseVO deleteHall(HallForm hallForm)<br/>前置条件：无<br/>后置条件：调用HallService领域对象的HallAccount(hallForm)方法 |
| data.management.HallService.selectAllHall();                 | 查找持久化对象                                               |
| data.management.HallService.selectHallById( int hallId);     | 查找持久化对象                                               |
| data.management.HallService.selectHallByName( String hallName); | 查找持久化对象                                               |
| data.management.HallService.selectHallHasSchedule( int hallId, Date date); | 查找持久化对象                                               |
| data.management.HallService.addHall( String name, Integer column,  Integer row); | 插入持久化对象                                               |
| data.management.HallService.changeHall( String name, Integer column,  Integer row); | 更新持久化对象                                               |
| data.management.HallService.deleteHall( String name);        | 删除持久化对象                                               |

##### 4.1.5 movie模块

(1)模块功能

详情参见需求文档

(2)整体设计图

![](C:\Users\msSsa\Downloads\movie.png)

<center>MovieController接口规范<center>



| 提供的服务                                              |                                                              |
| ------------------------------------------------------- | ------------------------------------------------------------ |
| addMovie(MovieForm)                                     | 语法：        public ResponseVO addMovie(MovieForm addMovieForm)<br/>前置条件：无<br/>后置条件：调用MovieService的addMovie方法 |
| searchOneMovieByIdAndUserId(int , int )                 | 语法：        public ResponseVO searchOneMovieByIdAndUserId(int id, int userId)<br/>前置条件：无<br/>后置条件：调用MovieService的searchOneMovieByIdAndUserId方法 |
| searchAllMovie()                                        | 语法：        public ResponseVO searchAllMovie()<br/>前置条件：无<br/>后置条件：调用MovieService的searchAllMovie方法 |
| searchOtherMoviesExcludeOff()                           | 语法：       public ResponseVO searchOtherMoviesExcludeOff()<br/>前置条件：无<br/>后置条件：调用MovieService的searchOtherMoviesExcludeOff方法 |
| getMovieByKeyword(String)                               | 语法：       public ResponseVO getMovieByKeyword(String keyword)<br/>前置条件：无<br/>后置条件：调用MovieService的getMovieByKeyword方法 |
| pullOfBatchOfMovie(MovieBatchOffForm)                   | 语法：       public ResponseVO pullOfBatchOfMovie(MovieBatchOffForm movieBatchOffForm)<br/>前置条件：无<br/>后置条件：调用MovieService的pullOfBatchOfMovie方法 |
| updateMovie(MovieForm)                                  | 语法：       public ResponseVO updateMovie(MovieForm updateMovieForm)<br/>前置条件：无<br/>后置条件：调用MovieService的updateMovie方法 |
| **需要的服务(需接口)**                                  |                                                              |
| MovieService.<br/>addMovie(MovieForm)                   | 添加一条电影信息                                             |
| MovieService.<br/>searchOneMovieByIdAndUserId(int, int) | 搜索一条电影信息                                             |
| MovieService.<br>searchAllMovie()                       | 搜索所有电影信息                                             |
| MovieService.<br/>searchOtherMoviesExcludeOff()         | 搜索未下架电影信息                                           |
| MovieService.<br/>getMovieByKeyword(String)             | 通过关键词搜索一条电影信                                     |
| MovieService.<br/>pullOfBatchOfMovie(MovieBatchOffForm) | 批量下架电影                                                 |
| MovieService.<br/>updateMovie(MovieForm)                | 更新影厅信息                                                 |

<center>MovieServiceImpl的接口规范<center>


| **提供的服务**                           |                                                              |
| ---------------------------------------- | ------------------------------------------------------------ |
| MovieService.addMovie                    | 语法：        ResponseVO addMovie(MovieForm addMovieForm);<br/>前置条件：管理员已登录<br/>后置条件：更新电影的数据 |
| MovieService.searchOneMovieByIdAndUserId | 语法：       ResponseVO searchOneMovieByIdAndUserId(int id, int userId);<br/>前置条件：管理员已登录<br/>后置条件：查找数据库并返回 |
| MovieService.searchAllMovie              | 语法：      ResponseVO searchAllMovie();<br/>前置条件：管理员已登录<br/>后置条件：查找数据库并返回 |
| MovieService.searchOtherMoviesExcludeOff | 语法：      ResponseVO searchOtherMoviesExcludeOff();<br/>前置条件：管理员已登录<br/>后置条件：查找数据库并返回 |
| MovieService.getMovieByKeyword           | 语法：     ResponseVO getMovieByKeyword(String keyword);<br/>前置条件：管理员已登录<br/>后置条件：查找数据库并返回 |
| MovieService.pullOfBatchOfMovie          | 语法：     ResponseVO pullOfBatchOfMovie(MovieBatchOffForm movieBatchOffForm);<br/>前置条件：管理员已登录<br/>后置条件：更新数据库 |
| MovieService.updateMovie                 | 语法：     ResponseVO updateMovie(MovieForm updateMovieForm);<br/>前置条件：管理员已登录 <br/> 后置条件：更新数据库 |
| **需要的服务**                           |                                                              |
| data.management.MovieMapper.insertMovie  | 插入持久化对象                                               |
| data.management.MovieMapper.updateMovie  | 更新持久化对象                                               |
| data.management.MovieMapper.deleteMovie  | 删除持久化对象                                               |
| data.management.MovieMapper.selectMovie  | 查询持久化对象                                               |


##### 4.1.6 schedule模块

(1)模块功能

详情参见需求文档

(2)整体设计图

![](C:\Users\msSsa\Downloads\schedule.png)

<center>ScheduleController接口规范<center>




| 提供的服务                                    |                                                              |
| --------------------------------------------- | ------------------------------------------------------------ |
| addMovie(MovieForm)                           | 语法：       public ResponseVO addSchedule(ScheduleForm scheduleForm)<br/>前置条件：无<br/>后置条件：调用ScheduleService的addSchedule方法 |
| updateSchedule(ScheduleForm)                  | 语法：       public ResponseVO updateSchedule(ScheduleForm scheduleForm)<br/>前置条件：无<br/>后置条件：调用ScheduleService的updateSchedule方法 |
| searchSchedule(int , Date )                   | 语法：      public ResponseVO searchSchedule(int hallId, Date startDate)<br/>前置条件：无<br/>后置条件：调用ScheduleService的searchScheduleSevenDays方法 |
| searchAudienceSchedule(int)                   | 语法：      public ResponseVO searchAudienceSchedule(int movieId)<br/>前置条件：无<br/>后置条件：调用ScheduleService的searchAudienceSchedule方法 |
| **需要的服务(需接口)**                        |                                                              |
| ScheduleService.<br/>addSchedule(MovieForm)   | 添加一条排片信息                                             |
| ScheduleService.<br/>updateSchedule(int, int) | 更新一条排片信息                                             |
| ScheduleService.<br>searchScheduleSevenDays() | 搜索所有排片信息                                             |
| ScheduleService.<br/>searchAudienceSchedule() | 搜索未下架排片信息                                           |

<center>ScheduleServiceImpl的接口规范<center>


| **提供的服务**                                |                                                              |
| --------------------------------------------- | ------------------------------------------------------------ |
| management.Schedule.addSchedule               | 语法：     ResponseVO addSchedule(ScheduleForm scheduleForm);<br/>前置条件：管理员已登录 <br/>后置条件：更新数据库 |
| management.Schedule.searchScheduleSevenDays   | 语法：     ResponseVO searchScheduleSevenDays(int hallId, Date startDate);<br/>前置条件：管理员已登录 <br/>后置条件：查看数据库并且返回 |
| management.Schedule.setScheduleView           | 语法：     ResponseVO setScheduleView(ScheduleViewForm scheduleViewForm);<br/>前置条件：管理员已登录 <br/>后置条件：更新数据库 |
| management.Schedule.deleteBatchOfSchedule     | 语法：    ResponseVO deleteBatchOfSchedule(ScheduleBatchDeleteForm scheduleBatchDeleteForm);<br/>前置条件：管理员已登录 <br/>后置条件：更新数据库 |
| management.Schedule.updateSchedule            | 语法：    ResponseVO updateSchedule(ScheduleForm scheduleForm);<br/>前置条件：管理员已登录  <br/> 后置条件：更新数据库 |
| management.Schedule.getScheduleById           | 语法：    ResponseVO getScheduleById(int id);<br/>前置条件：管理员已登录  <br/>后置条件：查找数据库并且返回 |
| **需要的服务**                                |                                                              |
| data.management.ScheduleMapper.insertSchedule | 插入持久化对象                                               |
| data.management.ScheduleMapper.updateSchedule | 更新持久化对象                                               |
| data.management.ScheduleMapper.deleteSchedule | 删除持久化对象                                               |
| data.management.ScheduleMapper.selectSchedule | 查询持久化对象                                               |


##### 4.1.7 activity模块

(1)模块功能

详情参见需求文档

(2)整体设计图

![](C:\Users\msSsa\Downloads\activity.png)

| 提供的服务                              |                                                              |
| --------------------------------------- | ------------------------------------------------------------ |
| publishActivity(ActivityForm)           | 语法：      public ResponseVO publishActivity(@RequestBody ActivityForm activityForm)<br/>前置条件：无<br/>后置条件：调用ScheduleService的publishActivity方法 |
| getActivities()                         | 语法：      public ResponseVO getActivities()<br/>前置条件：无<br/>后置条件：调用ScheduleService的getActivities方法 |
| updateActivity(ActivityUpdateVO)        | 语法：     public ResponseVO updateActivity(@RequestBody ActivityUpdateVO activityUpdateVO)<br/>前置条件：无<br/>后置条件：调用ScheduleService的updateActivity方法 |
| deleteActivity(ActivityBatchDeleteForm) | 语法：      public ResponseVO deleteActivity(@RequestBody ActivityBatchDeleteForm activityBatchDeleteForm)<br/>前置条件：无<br/>后置条件：调用ScheduleService的deleteActivity方法 |
| **需要的服务(需接口)**                  |                                                              |
| ActivityService.<br/>publishActivity    | 添加一条活动信息                                             |
| ActivityService.<br/>getActivities      | 搜索所有活动信息                                             |
| ActivityService.<br>updateActivity      | 更新一条活动信息                                             |
| ActivityService.<br/>deleteActivity     | 删除一条活动信息                                             |

<center>ActivityServiceImpl的接口规范<center>


| **提供的服务**                                |                                                              |
| --------------------------------------------- | ------------------------------------------------------------ |
| promotion.AcitivityService.publishActivity                   | 语法：        ResponseVO publishActivity(ActivityForm activityForm);<br/>前置条件：管理员已登录<br/>后置条件：显示优惠活动信息 |
| promotion.ActivityService.getActivities                      | 语法：        ResponseVO getActivities();<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：显示优惠活动信息 |
| promotion.ActivityService.updateActivity                     | 语法：       ResponseVO updateActivity(ActivityUpdateVO activityUpdateVO);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：更新优惠活动信息 |
| promotion.ActivityService.deleteActivity                     | 语法：        ResponseVO deleteActivity(ActivityBatchDeleteForm activityBatchDeleteForm);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：更新优惠活动信息 |
| **需要的服务**                                |                                                              |
| data.promotion.ActivityMapper.insertActivity(Activity activity); | 插入单一持久化对象                                           |
| data.promotion.ActivityMapper.insertActivityAndMovie( int activityId, List<Integer> movieId); | 插入多个持久化对象                                           |
| data.promotion.ActivityMapper.selectActivities();            | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectActivityByCoupon(Integer couponId); | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectActivitiesByMovie(int movieId); | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectById(int id);            | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectActivitiesWithoutMovie(); | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.updateCoupon(String name,String description, double targetAmount,double discountAmount,  Timestamp startTime,  Timestamp endTime); | 选择持久化对象                                               |
| data.promotion.ActivityMapper.updateActivity(String name,String description, double targetAmount,double discountAmount,  Timestamp startTime,  Timestamp endTime); | 选择持久化对象                                               |
| data.promotion.ActivityMapper.deleteById(int id);            | 删除持久化对象                                               |
| data.promotion.ActivityMapper.deleteCouponById(int id);      | 删除持久化对象                                               |



##### 4.1.8 coupon模块

(1)模块功能

详情参见需求文档

(2)整体设计图

![](C:\Users\msSsa\Downloads\coupon.png)

(3)

<center>CouponController的接口规范<center>

| 提供的服务                                      |                                                              |
| ----------------------------------------------- | ------------------------------------------------------------ |
| getCoupons(@PathVariable int userId)            | 语法：      public ResponseVO getCoupons(@PathVariable int userId)<br/>前置条件：无<br/>后置条件：调用CouponService的getCouponsByUser方法 |
| getSpecialCoupon()                              | 语法：      public ResponseVO getSpecialCoupon()<br/>前置条件：无<br/>后置条件：调用CouponService的getSpecialCoupon方法 |
| updateSpecialCouponDiscount                     | 语法：     public ResponseVO updateSpecialCouponDiscount<br/>前置条件：无<br/>后置条件：调用CouponService的updateSpecialCouponDiscount方法 |
| issueCoupon                                     | 语法：      public ResponseVO issueCoupon<br/>前置条件：无<br/>后置条件：调用CouponService的issueCoupon方法 |
| **需要的服务(需接口)**                          |                                                              |
| ActivityService.<br/>getCouponsByUser           | 获得用户的优惠券信息                                         |
| ActivityService.<br/>getSpecialCoupon           | 获得无门槛优惠券信息                                         |
| ActivityService.<br>updateSpecialCouponDiscount | 更新无门槛优惠券信息                                         |
| ActivityService.<br/>issueCoupon                | 发布优惠券                                                   |

<center>CouponServiceImpl的接口规范<center>



| **提供的服务**                                               |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| promotion.CouponService.getCouponsByUser                     | 语法：        ResponseVO getCouponsByUser(int userId);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：显示优惠活动信息 |
| promotion.CouponService.addCoupon                            | 语法：        ResponseVO addCoupon(CouponForm couponForm);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：更新优惠活动信息 |
| promotion.CouponService.issueCoupon                          | 语法：        ResponseVO issueCoupon(List<Integer> userId);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：显示优惠活动信息 |
| promotion.CouponService.getSpecialCoupon                     | 语法：       ResponseVO getSpecialCoupon();<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：显示优惠活动信息 |
| promotion.CouponService.updateSpecialCouponDiscount          | 语法：        ResponseVO updateSpecialCouponDiscount(double discount);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：更新优惠活动信息 |
| **需要的服务**                                               |                                                              |
| data.promotion.ConponMapper.insertCoupon(Coupon coupon);     | 插入单一持久化对象                                           |
| data.promotion.ConponMapper.selectCouponByUser(int userId);  | 查找单一持久化对象                                           |
| data.promotion.ConponMapper.selectById(int id);              | 查找单一持久化对象                                           |
| data.promotion.ConponMapper.insertCouponUser( int couponId,  int userId); | 插入单一持久化对象                                           |
| data.promotion.ConponMapper.deleteCouponUser( int couponId,  int userId); | 删除单一持久化对象                                           |
| data.promotion.ConponMapper.selectCouponByUserAndAmount( int userId,  double amount); | 查找持久化对象                                               |
| data.promotion.ConponMapper.selectSpecialCoupon();           | 查找单一持久化对象                                           |
| data.promotion.ConponMapper.updateSpecialCoupon(double discount); | 更新持久化对象                                               |

##### 4.1.9 vipcard模块

(1)模块功能

详情参见需求文档

(2)整体设计图
![](C:\Users\msSsa\Downloads\vipcard.png)

<center>VIPCardController的接口规范<center>


| 提供的服务                                           |                                                              |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| addVIP(int userId)<br/>                              | 语法：      public ResponseVO addVIP(@RequestParam int userId)<br/>前置条件：无<br/>后置条件：调用VIPCardService的addVIPCard方法 |
| getVIP(@PathVariable int userId)                     | 语法：      public ResponseVO getVIP(@PathVariable int userId)<br/>前置条件：无<br/>后置条件：调用VIPCardService的getCardByUserId方法 |
| charge(@RequestBody VIPCardForm vipCardForm)<br/>    | 语法：    public ResponseVO charge(@RequestBody VIPCardForm vipCardForm)<br/>前置条件：无<br/>后置条件：调用VIPCardService的charge方法 |
| getVIPInfo()                                         | 语法：      public ResponseVO getVIPInfo()<br/>前置条件：无<br/>后置条件：调用VIPCardService的getVIPInfo方法 |
| updateVIPInfo(@RequestBody VIPInfoVO vipInfoVO)<br/> | 语法：     public ResponseVO updateVIPInfo(@RequestBody VIPInfoVO vipInfoVO)<br/>前置条件：无<br/>后置条件：调用VIPCardService的updateVIPInfo方法 |
| getChargeHistoryByUserId(@PathVariable int userId)   | 语法：      public ResponseVO getChargeHistoryByUserId(@PathVariable int userId)<br/>前置条件：无<br/>后置条件：调用VIPCardService的getChargeHistoryByUserId方法 |
| **需要的服务(需接口)**                               |                                                              |
| VIPCardService.<br/>addVIPCard                       | 添加会员卡信息                                               |
| VIPCardService.<br/>getCardByUserId                  | 获取会员卡信息                                               |
| VIPCardService.<br>charge                            | 充值会员卡                                                   |
| VIPCardService.<br/>getVIPInfo                       | 获得会员卡策略                                               |
| VIPCardService.<br/>updateVIPInfo                    | 更新会员卡策略                                               |
| VIPCardService.<br/>getChargeHistoryByUserId         | 获得充值信息                                                 |

<center>VIPCardServiceImpl的接口规范<center>

| **提供的服务**                                               |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| promotion.VIPService.addVIPCard                              | 语法：        ResponseVO addVIPCard(int userId);<br/>前置条件：管理员已登录<br/>后置条件：更新VIP卡信息 |
| promotion.VIPService.getVIPInfo                              | 语法：        ResponseVO getVIPInfo();<br/>前置条件：管理员已登录<br/>后置条件：显示VIP卡信息 |
| promotion.VIPService.charge                                  | 语法：       ResponseVO charge(VIPCardForm vipCardForm);<br/>前置条件：管理员已登录<br/>后置条件：更新VIP卡信息 |
| promotion.VIPService.getCardByUserId                         | 语法：        ResponseVO getCardByUserId(int userId);<br/>前置条件：管理员已登录<br/>后置条件：显示VIP卡信息 |
| promotion.VIPService.updateVIPInfo                           | 语法：        ResponseVO updateVIPInfo(VIPInfoVO vipInfoVO);<br/>前置条件：管理员已登录<br/>后置条件：更新VIP卡信息 |
| promotion.VIPService.getChargeHistoryByUserId                | 语法：       ResponseVO getChargeHistoryByUserId(int userId);<br/>前置条件：管理员已登录<br/>后置条件：显示VIP卡信息 |
| **需要的服务**                                               |                                                              |
| data.promption.VIPCardMapper.insertOneCard(VIPCard vipCard); | 插入单一持久化对象                                           |
| data.promption.VIPCardMapper.selectCardById(int id);         | 查找单一持久化对象                                           |
| data.promption.VIPCardMapper.updateCardBalance( int id, double balance); | 更新单一持久化对象                                           |
| data.promption.VIPCardMapper.selectCardByUserId(int userId); | 查找单一持久化对象                                           |
| data.promption.VIPCardMapper.selectVIPInfo();                | 查找持久化对象                                               |
| data.promption.VIPCardMapper.updateVIPInfo( double price, double charge,  double bonus); | 更新单一持久化对象                                           |
| data.promption.VIPCardMapper.insertChargeHistory(VIPCardChargeHistory history); | 插入单一持久化对象                                           |
| data.promption.VIPCardMapper.selectChargeHistoryByUserId(int userId); | 查找单一持久化对象                                           |

##### 4.1.10 movielike模块

(1)模块功能

详情参见需求文档

(2)整体设计图

![](C:\Users\msSsa\Downloads\movielike.png)

(3)

<center>MovieController的接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| likeMovie(@PathVariable int movieId,@RequestParam int userId) | 语法：      public ResponseVO likeMovie(@PathVariable int movieId,@RequestParam int userId)<br/>前置条件：无<br/>后置条件：调用MovielikeService的likeMovie方法 |
| unlikeMovie(@PathVariable int movieId,@RequestParam int userId) | 语法：      public ResponseVO unlikeMovie(@PathVariable int movieId,@RequestParam int userId)<br/>前置条件：无<br/>后置条件：调用MovielikeService的unLikeMovie方法 |
| getMovieLikeCounts(@PathVariable int movieId)                | 语法：    public ResponseVO getMovieLikeCounts(@PathVariable int movieId)<br/>前置条件：无<br/>后置条件：调用MovielikeService的getCountOfLikes方法 |
| getMovieLikeCountByDate(@PathVariable int movieId)           | 语法：      public ResponseVO getMovieLikeCountByDate(@PathVariable int movieId)<br/>前置条件：无<br/>后置条件：调用MovielikeService的getLikeNumsGroupByDate方法 |
| **需要的服务(需接口)**                                       |                                                              |
| MovielikeService.<br/>likeMovie                              | 添加标记信息                                                 |
| MovielikeService.<br/>unLikeMovie                            | 取消标记信息                                                 |
| MovielikeService.<br>getCountOfLikes                         | 获得"喜欢"标记人数                                           |
| MovielikeService.<br/>getLikeNumsGroupByDate                 | 获得每日"喜欢"标记人数                                       |

<center>MovielikeServiceImpl的接口规范<center>


| **提供的服务**                                               |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| statistics.MovieLikeService.likeMovie                        | 语法：        ResponseVO likeMovie(int userId, int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| statistics.MovieLikeService.unLikeMovie                      | 语法：        ResponseVO unLikeMovie(int userId,int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| statistics.MovieLikeService.getCountOfLikes                  | 语法：        ResponseVO getCountOfLikes(int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| **需要的服务**                                               |                                                              |
| data.statistics.MovieLikeMapper.insertOneLike(int movieId ,int userId); | 插入单一持久化对象                                           |
| data.statistics.MovieLikeMapper.deleteOneLike(int movieId ,int userId); | 删除单一持久化对象                                           |
| data.statistics.MovieLikeMapper.selectLikeNums( int movieId); | 查找持久化对象                                               |
| data.statistics.MovieLikeMapper.selectLikeMovie( int movieId ,int userId); | 查找持久化对象                                               |
| data.statistics.MovieLikeMapper.getDateLikeNum( int movieId); | 查找持久化对象                                               |
##### 4.1.11 statistics模块

(1)模块功能

详情参见需求文档

(2)整体设计图

![](C:\Users\msSsa\Downloads\statistics.png)

(3)

<center>StatisticsController的接口规范<center>


| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| getScheduleRateByDate<br>(@RequestParam(required = false) Date date) | 语法：      public ResponseVO getScheduleRateByDate(@RequestParam(required = false) Date date)<br/>前置条件：无<br/>后置条件：调用StatisticsService的getScheduleRateByDate方法 |
| getTotalBoxOffice()                                          | 语法：      public ResponseVO getTotalBoxOffice()<br/>前置条件：无<br/>后置条件：调用StatisticsService的getTotalBoxOffice方法 |
| getAudiencePrice()                                           | 语法：    public ResponseVO getAudiencePrice()<br/>前置条件：无<br/>后置条件：调用StatisticsService的getAudiencePriceSevenDays方法 |
| getMoviePlacingRateByDate<br>(@RequestParam Date date)       | 语法：      public ResponseVO getMoviePlacingRateByDate(@RequestParam Date date)<br/>前置条件：无<br/>后置条件：调用StatisticsService的getMoviePlacingRateByDate方法 |
| getPopularMovies<br>(@RequestParam int days, @RequestParam int movieNum) | 语法：     public ResponseVO getPopularMovies(@RequestParam int days, @RequestParam int movieNum)<br/>前置条件：无<br/>后置条件：调用StatisticsService的getPopularMovies方法 |
| **需要的服务(需接口)**                                       |                                                              |
| StatisticsService.<br/>getScheduleRateByDate                 | 获取某日各影片排片率统计数据                                 |
| StatisticsService.<br/>getTotalBoxOffice                     | 获取所有电影的累计票房(降序排序，且包含已下架的电影)         |
| StatisticsService.<br>getAudiencePriceSevenDays              | 获取客单价                                                   |
| StatisticsService.<br/>getMoviePlacingRateByDate             | 获取上座率                                                   |
| StatisticsService.getPopularMovies                           | 获取最受欢迎电影                                             |

<center>StatisticsServiceImpl的接口规范<center>



| **提供的服务**                                               |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| statistics.StatisticsService.getScheduleRateByDate           | 语法：        ResponseVO getScheduleRateByDate(Date date);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| statistics.StatisticsService.getTotalBoxOffice               | 语法：        ResponseVO getTotalBoxOffice();<br/>前置条件：管理员已登录并启动查看统计信息功能 <br/>后置条件：返回统计信息 |
| statistics.StatisticsService.getAudiencePriceSevenDays       | 语法：        ResponseVO getAudiencePriceSevenDays();<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| statistics.StatisticsService.getMoviePlacingRateByDate       | 语法：        ResponseVO getMoviePlacingRateByDate(Date date);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| statistics.StatisticsService.getPopularMovies                | 语法：       ResponseVO getPopularMovies(int days, int movieNum);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| **需要的服务**                                               |                                                              |
| data.statistics.StatisticsMapper.selectMovieScheduleTimes( Date date,  Date nextDate); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectMovieTotalBoxOffice(); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectAudiencePrice( Date date, Date nextDate); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.getMoviePlacingRateByDate(Date date,  Date nextDate); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectPopularMovie(Date startDate, Date endDate); | 查找持久化对象                     |