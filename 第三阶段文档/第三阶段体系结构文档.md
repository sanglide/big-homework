软件体系结构文档模板

## 文档修改历史

## 目录

1. 引言
2. 产品概述
3. 逻辑视角
4. 组合视角
5. 接口视角
6. 信息视角



## 1.引言 

### 1.1编制目的

```
本报告详细完成对影院信息管理系统的概要设计，达到指点详细设计和开发的目的，同时实现和测试人员及用户的沟通。
```



### 1.2词汇表

| 词汇名称 | 词汇含义         | 备注 |
| :------: | ---------------- | ---- |
|   CIMS   | 影院信息管理系统 | 无   |



### 1.3参考资料

```
		软件工程与计算二（丁二玉 刘钦）
```



## 2.产品概述

参考影院信息管理系统用例文档和需求规格说明书中对产品的概括描述。

## 3.逻辑视图

- 处理静态设计模型
  - 影院信息管理系统中，选择了分层体系结构风格，将系统分为三层（展示层、业务逻辑层、数据层）能够更好的示意高层抽象。展示层包括html页面的实现，逻辑层包含逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如下图所示。
- 示意图
  ![img](http://ruangong.oss-cn-beijing.aliyuncs.com/%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png)

 ![](https://lastci.oss-cn-beijing.aliyuncs.com/%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%8811.jpg)

## 4.组合视角

### 4.1开发包图

| 开发（物理）包    | 依赖的其他包                                                 |
| ----------------- | :----------------------------------------------------------- |
| userbllmpl        |                                                              |
| userbl            | userbllmpl, userdatalmpl, po, utilitbly, datafactoryservice  |
| userdatalmpl      | ajax, po                                                     |
| userdata          | ajax, userdatalmpl, po, databaseutility                      |
| managebllmpl      |                                                              |
| managebl          | managementbllmpl, managedatalmpl, po, utilitybl, datafactoryservice,promotionbl |
| managedatalmpl    | ajax, po                                                     |
| managedata        | ajax, managedatalmpl, po, databaseutility                    |
| statisticsbllmpl  |                                                              |
| statisticsbl      | statisticsbllmpl, statisticsdatalmpl, po, utilitybl, datafactoryservice, |
|                   | salesubl,promotionbl                                         |
| staisticsdatalmpl | ajax, po                                                     |
| statisticsdata    | ajax, statisticsdatalmpl, po, databaseutility                |
| promotionbllmpl   |                                                              |
| promotionbl       | promotionbllmpl, promotiondatalmpl, po, utilitybl, datafactoryservice |
| promotiondatalmpl | ajax, po                                                     |
| promotiondata     | ajax, promotiondatalmpl, po, databaseutility                 |
| salesbllmpl       |                                                              |
| salesbl           | salesbllmpl, salesdatalmpl, po, utilitybl, datafactoryservice, |
|                   | manageui, userui                                             |
| salesdatalmpl     | ajax, po                                                     |
| salesdata         | ajax, salesdatalmpl, po, databaseutility                     |
| vo                |                                                              |
| po                |                                                              |
| utilitybl         |                                                              |



![icon](https://lastci.oss-cn-beijing.aliyuncs.com/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.jpg)

```
                              电影信息管理系统web端开发包图
```



![icon](https://lastci.oss-cn-beijing.aliyuncs.com/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.jpg)

```
                              电影信息管理服务端开发包图
```



### 4.2运行时进程

```
		表示软件在运行时进程间的交互，描述系统的动态结构
```

![](https://lastci.oss-cn-beijing.aliyuncs.com/%E8%BF%9B%E7%A8%8B%E5%9B%BE.jpg)



### 4.3物理部署



![icon](https://lastci.oss-cn-beijing.aliyuncs.com/%E9%83%A8%E7%BD%B2%E5%9B%BE.jpg)

## 5.架构设计

- 描述功能分解和如何在不同的层中安排软件模块

  - 描述架构中的对象，包含架构图
  - 描述组件接口信息
    - 包括：语法、前置条件、后置条件

  ### 5.1模块职责

- 模块视图

  ![](http://dierci.oss-cn-beijing.aliyuncs.com/%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE.png)

- 各层职责

  ```
  客户端各层的职责
  ```

|       层       |                     职责                     |
| :------------: | :------------------------------------------: |
|    启动模块    |     负责初始化网络通信机制，启动用户界面     |
|   用户界面层   |                   展示界面                   |
|   业务逻辑层   | 对于用户界面的输入进行响应并进行业务处理逻辑 |
| 客户端网络模块 |          通过web请求调用WebService           |

```
								服务器各层的职责
```

|       层       |                 职责                 |      |
| :------------: | :----------------------------------: | ---- |
|    启动模块    | 负责初始化网络通信机制，启动用户界面 |      |
|     数据层     |    负责数据的持久化及数据访问接口    |      |
| 服务器网络模块 |      提供WebService远程调用服务      |      |



- 层之间调用接口

|                             接口                             | 服务调用方       | 服务提供方       |
| :----------------------------------------------------------: | ---------------- | ---------------- |
| AdminService<br/>HallService<br/>MovieService<br/>ScheduleService<br/>ActivityService<br/>CouponService<br/>VIPService | 客户端展示层     | 客户端业务逻辑层 |
|                        TicketService                         |                  |                  |
|                       MovieLikeService                       |                  |                  |
|                      StatisticsService                       |                  |                  |
|                        AccountService                        |                  |                  |
|                                                              |                  |                  |
| AdminMapper<br/>HallMapper<br/>MovieMapper<br/>SceduleMapper<br/>ActivityMapper<br/>CouponMapper<br/>VIPCardMapper<br/>DatabaseFactory | 客户端业务逻辑层 | 服务器端数据层   |
|                         TicketMapper                         |                  |                  |
|                       MovieLikeMapper                        |                  |                  |
|                       StatisticsMapper                       |                  |                  |
|                        AccountMapper                         |                  |                  |
|                                                              |                  |                  |

### 5.2用户界面层分解

```
		根据需求，系统存在19个用户界面：登陆界面、影院员工主界面、观众主界面、管理员主界面、查看电影列表界面、查看电影详情界面、排片界面、查看统计数据界面、购买电影票界面、会员界面、上架电影、统计电影想看人数界面、发布优惠活动界面。界面跳转如下图所示：
```



用户界面类图如下图所示

![](http://dierci.oss-cn-beijing.aliyuncs.com/%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E8%B7%B3%E8%BD%AC.png)

#### 5.2.1模块的职责

```
用户界面层模块的职责如下表所示：
```

|   模块    |                 职责                 |
| :-------: | :----------------------------------: |
| MainFrame | 界面Frame,负责界面的显示和界面的跳转 |

#### 5.2.2接口规范

```
用户界面层模块的接口规范如下表所示：
```

|  接口名   | 语法         | init(args:String[])     |
| :-------: | :----------- | ----------------------- |
| MainFrame | **前置条件** | 无                      |
|           | **后置条件** | 显示Frame以及LoginPanel |

```
用户界面层需要的服务接口如下表所示：
```

|              服务名              | 服务                           |
| :------------------------------: | ------------------------------ |
|      bl.user.AccountService      | 登陆界面的业务逻辑接口         |
|    bl.management.MovieService    | 查看电影详情界面的业务逻辑接口 |
|  bl.management.ScheduleService   | 排片界面的业务逻辑接口         |
| bl.statistics.StaticsticsService | 查看统计数据界面的业务逻辑接口 |
|   bl.promotion.ActivityService   | 发布优惠活动界面的业务逻辑接口 |
|      bl.sales.TicketService      | 购买电影票界面的业务逻辑接口   |
|    bl.promotion.CouponService    | 查看优惠券的业务逻辑接口       |
|  bl.statistics.MovieLikeService  | 查看电影喜欢人数的业务逻辑接口 |
|                                  |                                |

### 5.3 业务逻辑层的分解

#### 5.3.1 业务逻辑层模块的职责

| 模块         | 职责                                                     |
| ------------ | -------------------------------------------------------- |
| userbl       | 实现用户信息管理和登录注册需要服务                       |
| managebl     | 实现管理员排片、上架电影、影厅管理、管理员工账号需要服务 |
| statisticsbl | 实现统计数据管理、想看人数统计需要的服务                 |
| promotionbl  | 实现发布和应用优惠策略、活动、VIP卡需要的服务            |
| salesbl      | 实现电影票销售需要的服务                                 |

#### 5.3.2 业务逻辑层模块的接口规范

<center>userbl模块的接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| User.AccountService.login                                    | 语法：        public UserVO login(UserForm userForm);<br/>前置条件：userForm表单验证成功<br/>后置条件：查找是否存在相应的User，根据输入的userForm返回登陆验证的结果 |
| User.AccontSerivce.register                                  | 语法：       public ResponseVO registerAccount(UserForm userForm);<br/>前置条件：id没有和数据库已有的账户重复<br/>后置条件：提示注册成功 |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| DatabaseFacory.getUserDatabase()                             | 得到User数据库的服务的引用                                   |
| data.user.AccountMapper. createNewAccount( String username,String password); | 在数据库中新建User对象                                       |
| data.user.Account.getAccountByName( String username);        | 根据用户名在数据库中查找User对象                             |
| data.user.Account.selectAllUser();                           | 在数据库中查找所有User对象                                   |
|                                                              |                                                              |



<center>managementbl模块的接口规范<center>


| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| management.AdminService.selectAllAdminAccount                | 语法：       ResponseVO searchAllAdminAccount();<br/>前置条件：能够检索到数据库<br/>后置条件：查找数据库返回所有员工账号信息，没有则提示无结果 |
| managemen.AdminService.addAdminAccount                       | 语法：        ResponseVO addAdminAccount(UserForm userForm);<br/>前置条件：管理员已登录<br/>后置条件：更新员工账号数据 |
| management.AdminService.changeAdminAccount                   | 语法：        ResponseVO changeAdminAccount(AdminForm adminForm);<br/>前置条件：管理员已登录<br/>后置条件：更新员工的数据 |
| management.AdminService.deleteAdminAccount                   | 语法：        ResponseVO deleteAdminAccount(AccountBatchDeleteForm accountBatchDeleteForm);<br/>前置条件：管理员已登录<br/>后置条件：更新员工的数据 |
| management.HallService.searchAllHall                         | 语法：        ResponseVO searchAllHall();<br/>前置条件：管理员已登录<br/>后置条件：更新影厅的数据 |
| management.HallService.addHall                               | 语法：        ResponseVO addHall(HallForm hallForm);<br/>前置条件：管理员已登录
后置条件：更新影厅的数据 |
| management.HallService.changeHall                            | 语法：        ResponseVO changeHall(HallForm hallForm);<br/>前置条件：管理员已登录<br/> 后置条件：更新影厅的数据 |
| management.HallService.deleteHall                            | 语法：        ResponseVO deleteHall(HallForm hallForm);<br/>前置条件：管理员已登录<br/> 后置条件：更新影厅的数据 |
| management.MovieService.addMovie                             | 语法：        ResponseVO addMovie(MovieForm addMovieForm);<br/>前置条件：管理员已登录
 后置条件：更新电影的数据 |
| management.MovieService.searchOneMovieByIdAndUserId          | 语法：       ResponseVO searchOneMovieByIdAndUserId(int id, int userId);<br/>前置条件：管理员已登录
 后置条件：查找数据库并返回 |
| management.MovieService.searchAllMovie                       | 语法：      ResponseVO searchAllMovie();<br/>前置条件：管理员已登录
 后置条件：查找数据库并返回 |
| management.MovieService.searchOtherMoviesExcludeOff          | 语法：      ResponseVO searchOtherMoviesExcludeOff();<br/>前置条件：管理员已登录
 后置条件：查找数据库并返回 |
| management.MovieService.getMovieByKeyword                    | 语法：     ResponseVO getMovieByKeyword(String keyword);<br/>前置条件：管理员已登录
 后置条件：查找数据库并返回 |
| management.MovieService.pullOfBatchOfMovie                   | 语法：     ResponseVO pullOfBatchOfMovie(MovieBatchOffForm movieBatchOffForm);<br/>前置条件：管理员已登录
 后置条件：更新数据库 |
| managemrnt.MovieService.updateMovie                          | 语法：     ResponseVO updateMovie(MovieForm updateMovieForm);<br/>前置条件：管理员已登录 <br/> 后置条件：更新数据库 |
| management.Schedule.addSchedule                              | 语法：     ResponseVO addSchedule(ScheduleForm scheduleForm);<br/>前置条件：管理员已登录 
 后置条件：更新数据库 |
| management.Schedule.searchScheduleSevenDays                  | 语法：     ResponseVO searchScheduleSevenDays(int hallId, Date startDate);<br/>前置条件：管理员已登录 
 后置条件：查看数据库并且返回 |
| management.Schedule.setScheduleView                          | 语法：     ResponseVO setScheduleView(ScheduleViewForm scheduleViewForm);<br/>前置条件：管理员已登录 
 后置条件：更新数据库 |
| management.Schedule.deleteBatchOfSchedule                    | 语法：    ResponseVO deleteBatchOfSchedule(ScheduleBatchDeleteForm scheduleBatchDeleteForm);<br/>前置条件：管理员已登录 
 后置条件：更新数据库 |
| management.Schedule.updateSchedule                           | 语法：    ResponseVO updateSchedule(ScheduleForm scheduleForm);<br/>前置条件：管理员已登录  <br/> 后置条件：更新数据库 |
| management.Schedule.getScheduleById                          | 语法：    ResponseVO getScheduleById(int id);<br/>前置条件：管理员已登录  
 后置条件：查找数据库并且返回 |
| management.Scheduel.getScheduleView                          | 语法：    ResponseVO getScheduleView();<br/>前置条件：管理员已登录  <br/> 后置条件：查找数据库并且返回 |
| management.Schedule.searchAudienceSchedule                   | 语法：    ResponseVO searchAudienceSchedule(int movieId);<br/>前置条件：管理员已登录  
 后置条件：查找数据库并且返回 |
|                                                              |                                                              |
|                                                              |                                                              |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| data.management.AdminMapper.selectAllAdminAccount()          | 查找持久化对象                                               |
| data.management.AdminMapper.addAdminAccount( String username,  String password); | 插入单一持久化对象                                           |
| data.management.AdminMapper.changeAdminAccount( int id, String username, String password); | 更新单一持久化对象                                           |
| data.management.AdminMapper.deleteAdminAccount( int id);     | 删除单一持久化对象                                           |
| data.management.HallService.selectAllHall();                 | 查找持久化对象                                               |
| data.management.HallService.selectHallById( int hallId);     | 查找持久化对象                                               |
| data.management.HallService.selectHallByName( String hallName); | 查找持久化对象                                               |
| data.management.HallService.selectHallHasSchedule( int hallId, Date date); | 查找持久化对象                                               |
| data.management.HallService.addHall( String name, Integer column,  Integer row); | 插入持久化对象                                               |
| data.management.HallService.changeHall( String name, Integer column,  Integer row); | 更新持久化对象                                               |
| data.management.HallService.deleteHall( String name);        | 删除持久化对象                                               |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |

<center>statisticsbl模块的接口规范<center>




| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| statistics.MovieLikeService.likeMovie                        | 语法：        ResponseVO likeMovie(int userId, int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能<br/>后置条件：返回统计信息 |
| statistics.MovieLikeService.unLikeMovie                      | 语法：        ResponseVO unLikeMovie(int userId,int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能
后置条件：返回统计信息 |
| statistics.MovieLikeService.getCountOfLikes                  | 语法：        ResponseVO getCountOfLikes(int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能
后置条件：返回统计信息 |
| statistics.MovieLikeService.getLikeNumsGroupByDate           | 语法：        ResponseVO getLikeNumsGroupByDate(int movieId);<br/>前置条件：管理员已登录并启动查看统计信息功能
后置条件：返回统计信息 |
| statistics.StatisticsService.getScheduleRateByDate           | 语法：        ResponseVO getScheduleRateByDate(Date date);<br/>前置条件：管理员已登录并启动查看统计信息功能
后置条件：返回统计信息 |
| statistics.StatisticsService.getTotalBoxOffice               | 语法：        ResponseVO getTotalBoxOffice();<br/>前置条件：管理员已登录并启动查看统计信息功能 <br/>后置条件：返回统计信息 |
| statistics.StatisticsService.getAudiencePriceSevenDays       | 语法：        ResponseVO getAudiencePriceSevenDays();<br/>前置条件：管理员已登录并启动查看统计信息功能 
后置条件：返回统计信息 |
| statistics.StatisticsService.getMoviePlacingRateByDate       | 语法：        ResponseVO getMoviePlacingRateByDate(Date date);<br/>前置条件：管理员已登录并启动查看统计信息功能 
后置条件：返回统计信息 |
| statistics.StatisticsService.getPopularMovies                | 语法：       ResponseVO getPopularMovies(int days, int movieNum);<br/>前置条件：管理员已登录并启动查看统计信息功能 
后置条件：返回统计信息 |
|                                                              |                                                              |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| data.statistics.MovieLikeMapper.insertOneLike(int movieId ,int userId); | 插入单一持久化对象                                           |
| data.statistics.MovieLikeMapper.deleteOneLike(int movieId ,int userId); | 删除单一持久化对象                                           |
| data.statistics.MovieLikeMapper.selectLikeNums( int movieId); | 查找持久化对象                                               |
| data.statistics.MovieLikeMapper.selectLikeMovie( int movieId ,int userId); | 查找持久化对象                                               |
| data.statistics.MovieLikeMapper.getDateLikeNum( int movieId); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectMovieScheduleTimes( Date date,  Date nextDate); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectMovieTotalBoxOffice(); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectAudiencePrice( Date date, Date nextDate); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.getMoviePlacingRateByDate(Date date,  Date nextDate); | 查找持久化对象                                               |
| data.statistics.StatisticsMapper.selectPopularMovie(Date startDate, Date endDate); | 查找持久化对象                                               |
|                                                              |                                                              |
|                                                              |                                                              |

<center>promotionbl模块的接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| promotion.AcitivityService.publishActivity                   | 语法：        ResponseVO publishActivity(ActivityForm activityForm);<br/>前置条件：管理员已登录<br/>后置条件：显示优惠活动信息 |
| promotion.ActivityService.getActivities                      | 语法：        ResponseVO getActivities();<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：显示优惠活动信息 |
| promotion.ActivityService.updateActivity                     | 语法：       ResponseVO updateActivity(ActivityUpdateVO activityUpdateVO);<br/>前置条件：管理员已登录且优惠活动已存在<br/>后置条件：更新优惠活动信息 |
| promotion.ActivityService.deleteActivity                     | 语法：        ResponseVO deleteActivity(ActivityBatchDeleteForm activityBatchDeleteForm);<br/>前置条件：管理员已登录且优惠活动已存在
后置条件：更新优惠活动信息 |
| promotion.CouponService.getCouponsByUser                     | 语法：        ResponseVO getCouponsByUser(int userId);<br/>前置条件：管理员已登录且优惠活动已存在
后置条件：显示优惠活动信息 |
| promotion.CouponService.addCoupon                            | 语法：        ResponseVO addCoupon(CouponForm couponForm);<br/>前置条件：管理员已登录且优惠活动已存在
后置条件：更新优惠活动信息 |
| promotion.CouponService.issueCoupon                          | 语法：        ResponseVO issueCoupon(List<Integer> userId);<br/>前置条件：管理员已登录且优惠活动已存在
后置条件：显示优惠活动信息 |
| promotion.CouponService.getSpecialCoupon                     | 语法：       ResponseVO getSpecialCoupon();<br/>前置条件：管理员已登录且优惠活动已存在
后置条件：显示优惠活动信息 |
| promotion.CouponService.updateSpecialCouponDiscount          | 语法：        ResponseVO updateSpecialCouponDiscount(double discount);<br/>前置条件：管理员已登录且优惠活动已存在
后置条件：更新优惠活动信息 |
| promotion.VIPService.addVIPCard                              | 语法：        ResponseVO addVIPCard(int userId);<br/>前置条件：管理员已登录
后置条件：更新VIP卡信息 |
| promotion.VIPService.getVIPInfo                              | 语法：        ResponseVO getVIPInfo();<br/>前置条件：管理员已登录
后置条件：显示VIP卡信息 |
| promotion.VIPService.charge                                  | 语法：       ResponseVO charge(VIPCardForm vipCardForm);<br/>前置条件：管理员已登录
后置条件：更新VIP卡信息 |
| promotion.VIPService.getCardByUserId                         | 语法：        ResponseVO getCardByUserId(int userId);<br/>前置条件：管理员已登录
后置条件：显示VIP卡信息 |
| promotion.VIPService.updateVIPInfo                           | 语法：        ResponseVO updateVIPInfo(VIPInfoVO vipInfoVO);<br/>前置条件：管理员已登录
后置条件：更新VIP卡信息 |
| promotion.VIPService.getChargeHistoryByUserId                | 语法：       ResponseVO getChargeHistoryByUserId(int userId);<br/>前置条件：管理员已登录
后置条件：显示VIP卡信息 |
|                                                              | 语法：        ResponseVO addVIPCard(int userId);<br/>前置条件：管理员已登录
后置条件：更新VIP卡信息 |
|                                                              |                                                              |
|                                                              |                                                              |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| data.promotion.ActivityMapper.insertActivity(Activity activity); | 插入单一持久化对象                                           |
| data.promotion.ActivityMapper.insertActivityAndMovie( int activityId, List<Integer> movieId); | 插入多个持久化对象                                           |
| data.promotion.ActivityMapper.selectActivities();            | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectActivityByCoupon(Integer couponId); | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectActivitiesByMovie(int movieId); | 选择单一持久化对象                                           |
| data.promotion.ActivityMapper.selectById(int id);            | 得到Promotion数据库的服务的引用                              |
| data.promotion.ActivityMapper.selectActivitiesWithoutMovie(); |                                                              |
| data.promotion.ActivityMapper.updateCoupon(String name,String description, double targetAmount,double discountAmount,  Timestamp startTime,  Timestamp endTime); | 选择持久化对象                                               |
| data.promotion.ActivityMapper.updateActivity(String name,String description, double targetAmount,double discountAmount,  Timestamp startTime,  Timestamp endTime); | 选择持久化对象                                               |
| data.promotion.ActivityMapper.deleteById(int id);            | 删除持久化对象                                               |
| data.promotion.ActivityMapper.deleteCouponById(int id);      | 删除持久化对象                                               |
| data.promotion.ActivityMapper.deleteActivityById(int id);    | 删除持久化对象                                               |
| data.promotion.ConponMapper.insertCoupon(Coupon coupon);     | 插入单一持久化对象                                           |
| data.promotion.ConponMapper.selectCouponByUser(int userId);  | 查找单一持久化对象                                           |
| data.promotion.ConponMapper.selectById(int id);              | 查找单一持久化对象                                           |
| data.promotion.ConponMapper.insertCouponUser( int couponId,  int userId); | 插入单一持久化对象                                           |
| data.promotion.ConponMapper.deleteCouponUser( int couponId,  int userId); | 删除单一持久化对象                                           |
| data.promotion.ConponMapper.selectCouponByUserAndAmount( int userId,  double amount); | 查找持久化对象                                               |
| data.promotion.ConponMapper.selectSpecialCoupon();           | 查找单一持久化对象                                           |
| data.promotion.ConponMapper.updateSpecialCoupon(double discount); | 更新持久化对象                                               |
| data.promption.VIPCardMapper.insertOneCard(VIPCard vipCard); | 插入单一持久化对象                                           |
| data.promption.VIPCardMapper.selectCardById(int id);         | 查找单一持久化对象                                           |
| data.promption.VIPCardMapper.updateCardBalance( int id, double balance); | 更新单一持久化对象                                           |
| data.promption.VIPCardMapper.selectCardByUserId(int userId); | 查找单一持久化对象                                           |
| data.promption.VIPCardMapper.selectVIPInfo();                | 查找持久化对象                                               |
| data.promption.VIPCardMapper.updateVIPInfo( double price, double charge,  double bonus); | 更新单一持久化对象                                           |
| data.promption.VIPCardMapper.insertChargeHistory(VIPCardChargeHistory history); | 插入单一持久化对象                                           |
| data.promption.VIPCardMapper.selectChargeHistoryByUserId(int userId); | 查找单一持久化对象                                           |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |
|                                                              |                                                              |

<center>salesbl模块的接口规范<center>

| 提供的服务                                                   |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| Sales.TicketService.addTicket                                | 语法：        ResponseVO addTicket(TicketForm ticketForm);<br/>前置条件：观众已登录<br/>后置条件：更新观众的订单信息 |
| Sales.TicketService.completeTicket                           | 语法：        ResponseVO completeTicket(TicketsWithCouponForm ticketsWithCouponForm);<br/>前置条件：观众已登录
后置条件：判断是否成功 |
| Sales.TicketService.completeByVIPCard                        | 语法：        ResponseVO completeByVIPCard(TicketsWithCouponForm ticketsWithCouponForm);<br/>前置条件：观众已登录
后置条件：判断是否成功 |
| Sales.TicketService.cancelTicket                             | 语法：        ResponseVO cancelTicket(List<Integer> id);<br/>前置条件：观众已登录
后置条件：更新观众的订单信息 |
| Sales.TicketService.getBySchedule                            | 语法：       ResponseVO getBySchedule(int scheduleId);<br/>前置条件：观众已登录
后置条件：返回相关信息 |
| Sales.TicketService.getTicketByUser                          | 语法：        ResponseVO getTicketByUser(int userId);<br/>前置条件：观众已登录
后置条件：返回相关信息 |
| Sales.TicketService.addRefund                                | 语法：        ResponseVO addRefund(TicketRefundVO ticketRefundVO);<br/>前置条件：观众已登录
后置条件：更新观众的订单信息 |
| Sales.TicketService.updateRefund                             | 语法：        ResponseVO updateRefund(TicketRefundVO ticketRefundVO);<br/>前置条件：观众已登录
后置条件：更新观众的订单信息 |
| Sales.TicketService.getRefundInfo                            | 语法：       ResponseVO getRefundInfo();<br/>前置条件：观众已登录
后置条件：返回相关信息 |
| Sales.TicketService.getSaleHistory                           | 语法：       ResponseVO getSaleHistory(int userId);<br/>前置条件：观众已登录
后置条件：返回相关信息 |
| Sales.TicketService.refundById                               | 语法：       ResponseVO refundById(List<Integer> idList);<br/>前置条件：观众已登录
后置条件：返回相关信息 |
| Sales.TicketService.getUserByConsume                         | 语法：       ResponseVO getUserByConsume(double consume);<br/>前置条件：观众已登录
后置条件：返回相关信息 |
|                                                              |                                                              |
| **需要的服务**                                               |                                                              |
| 服务名                                                       | 服务                                                         |
| data.sales.TicketMapper.insertTicket(Ticket ticket);         | 插入单一持久化对象                                           |
| data.sales.TicketMapper.updateTicketState( int ticketId, int state); | 更新单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketsBySchedule(int scheduleId); | 查找单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketByScheduleIdAndSeat( int scheduleId,  int columnIndex,  int rowIndex); | 查找单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketById(int id);            | 查找单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketByUser(int userId);      | 得到Manage数据库的服务的引用                                 |
| data.sales.TicketMapper.insertTicketRefund(TicketRefund ticketRefund); | 插入单一持久化对象                                           |
| data.sales.TicketMapper.updateTicketRefund(Double rate, Integer limitHours); | 更新单一持久化对象                                           |
| data.sales.TicketMapper.selectRefundInfo();                  | 选择单一持久化对象                                           |
| data.sales.TicketMapper.insertTicketOrder(TicketOrder ticketOrder); | 插入单一持久化对象                                           |
| data.sales.TicketMapper.updateTicketOrder( Integer couponId,  Integer ticketId); | 更新单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketOrdersByUserId(int userId); | 选择单一持久化对象                                           |
| data.sales.TicketMapper.selectTicketOrderById(Integer id);   | 选择单一持久化对象                                           |
|                                                              |                                                              |





### 5.4 数据层的分解

#### 5.4.1数据层模块的职责

| 模块                      | 职责                                                         |
| :------------------------ | :----------------------------------------------------------- |
| UserDataService           | 用户登录注册信息持久化数据的接口，提供集体载入、集体保存、增、查服务 |
| UserDataServiceImpl       | 基于数据库的用户登录注册信息持久化数据的接口，提供集体载入、集体保存、增、查服务 |
| StatisticsDataService     | 电影想看人数持久化数据的接口，提供集体载入、集体保存、增、删、改、查服务 |
| StatisticsDataServiceImpl | 基于数据库的电影信息和想看人数持久化数据的接口，提供集体载入、集体保存、增、删、改、查服务 |
| ManageDataService         | 排片信息持久化数据的接口，提供集体载入、集体保存、增、删、改、查服务 |
| ManageDataServiceImpl     | 基于数据库的排片信息持久化数据的接口，提供集体载入、集体保存、增、删、改、查服务 |
| PromotionDataService      | 促销活动持久化数据的接口，提供集体载入、集体保存、增、删、改、查服务 |
| PromotionDataServiceImpl  | 基于数据库的促销活动持久化数据的接口，提供集体载入、集体保存、增、删、改、查服务 |
| SalesDataService          | 电影票信息持久化数据的接口，提供集体载入、集体保存、增服务   |
| SalesDataServiceImpl      | 基于数据库的电影票信息持久化数据的接口，提供集体载入、集体保存、增服务 |

#### 5.4.2 数据层模块的接口规范

| UserDataService提供的服务 |                                                              |
| ------------------------- | ------------------------------------------------------------ |
| UserDataService.find      | 语法：        public UserPO UserDataService.find(long id)<br/>前置条件：数据库中id存在<br/>后置条件：返回User的信息 |
| UserDataService.insert    | 语法：        public idCount UserDataService.insert（UserPO po）<br/>前置条件：数据库Id没有重复<br/>后置条件：数据库中添加一条UserPO记录并返回User的个数 |

| ManagementDataService提供的服务 |                                                              |
| ------------------------------- | ------------------------------------------------------------ |
| ManageDataService.find          | 语法：        public ManagePO ManageDataService.find(long id)<br/>前置条件：数据库中id存在<br/>后置条件：返回Movie |
| ManageDataService.finds         | 语法：        public MovieFormPO ManageDataService.finds(String field)<br/>前置条件：数据库能通过关键字检索到相关Movie<br/>后置条件：返回Movie列表 |
| ManageDataService.insert        | 语法：        public idCount >ManageDataService.insert（ManagePO po）<br/>前置条件：数据库Id没有重复<br/>后置条件：数据库中添加一条ManagePO记录并返回Manage的个数 |
| ManageDataService.update        | 语法：        public id ManageDataService.insert（ManagePO po）<br/>前置条件：数据库Id存在<br/>后置条件：数据库中更新一条ManagePO记录并返回Manage的id |
| ManageDataService.delete        | 语法：        public id ManageDataService.delete（ManagePO po）<br/>前置条件：数据库Id存在<br/>后置条件：数据库中更新一条ManagePO记录并返回Manage的id |

| PromotionDataService提供的服务 |                                                              |
| ------------------------------ | ------------------------------------------------------------ |
| PromotionDataService.find      | 语法：        public PromotionPO PromotionDataService.find(long id)<br/>前置条件：数据库中id存在<br/>后置条件：返回Movie |
| PromotionDataService.finds     | 语法：        public PromotionFormPO PromotionDataService.finds(String field)<br/>前置条件：数据库能通过关键字检索到相关Movie<br/>后置条件：返回Movie列表 |
| PromotionDataService.insert    | 语法：        public idCount PromotionDataService.insert（PromotionPO po）<br/>前置条件：数据库Id没有重复<br/>后置条件：数据库中添加一条PromotionPO记录并返回Promotion的个数 |
| PromotionDataService.update    | 语法：        public id PromotionDataService.insert（PromotionPO po）<br/>前置条件：数据库Id存在<br/>后置条件：数据库中更新一条PromotionPO记录并返回Promotion的id |
| PromotionDataService.delete    | 语法：        public id PromotionDataService.delete（PromotionPO po）<br/>前置条件：数据库Id存在<br/>后置条件：数据库中更新一条PromotionPO记录并返回Promotion的id |

| SalesDataService提供的服务 |                                                              |
| -------------------------- | ------------------------------------------------------------ |
| SalesDataService.insert    | 语法：        public idCount SalesDataService.insert（SalesPO po）<br/>前置条件：数据库Id没有重复<br/>后置条件：数据库中添加一条ManagePO记录并返回Movie的个数 |





### 6 信息视角

- 描述数据持久化对象(PO)

  系统的PO类就是对应的相关的实体类。

  Activity类：包含活动的名称、描述、开始时间、结束时间、参与电影、优惠券规格。

  AudiencePrice类：包含用户id和价格

  Coupon类：包含优惠券的名称、id、开始时间、失效时间、优惠金额

  DateLike类：包含喜爱人数、喜爱时间

  Hall类：包含影厅id、名称、列、行

  Movie类：包含电影id，电影名称，海报url，导演，编剧，主演，电影类型，制片国家/地区，语言，上映时间，片长，描述，电影状态

  MoviePlacingRateByDate类：包含id、名称、排片次数、观影次数

  MovieScheduleTime类：包含id、名称、排片次数

  MovieTotalBoxOffice类：包含id、名称、票房

  PopularMovies类：包含id、名称、票房

  ScheduleItem类：包含id、名称、开始时间、结束放映时间、票价

  Ticket类：包含用户id，影片id，电影时段，座位信息，交易时间，总价，优惠，实付金额

  Ticket类：

  TicketOrder类：包含orderid、优惠券id、电影列表

  TicketRefund类：包含id、收取的手续费占实付款的比例、在电影放映多少小时之前可以退票

  User类：包含用户的用户id，用户名，密码，用户角色

  VIPCard类：包含用户id、会员卡余额、办卡日期

  VIPCardChargeHistory类：包含id、充值金额、余额、日期

  VIPInfo类：包含id、单价、增送金额

  

```java


public class Activity {

    private int id;
    /**
     * 优惠活动名称
     */
    private String name;
    /**
     * 优惠活动描述
     */
    private String description;
    /**
     * 优惠活动开始时间
     */
    private Timestamp startTime;
    /**
     * 优惠活动截止时间
     */
    private Timestamp endTime;
    /**
     * 优惠电影列表
     */
    private List<Movie> movieList;
    /**
     * 优惠券规格
     */
    private Coupon coupon;
}


public class AudiencePrice {
    private Integer userId;
    private Double totalPrice;

    public Integer getUserId() {
        return userId;
    }

    public void setUserId(Integer userId) {
        this.userId = userId;
    }

    public Double getTotalPrice() {
        return totalPrice;
    }

    public void setTotalPrice(Double totalPrice) {
        this.totalPrice = totalPrice;
    }
}



public class Coupon {
	/**
	 * 优惠券id
	 */
	private int id;
	/**
	 * 优惠券描述
	 */
	private String description;
	/**
	 * 优惠券名称
	 */
	private String name;
	/**
	 * 优惠券使用门槛
	 */
	private double targetAmount;
	/**
	 * 优惠券优惠金额
	 */
	private double discountAmount;
	/**
	 * 可用时间
	 */
	private Timestamp startTime;
	/**
	 * 失效时间
	 */
	private Timestamp endTime;
}



public class DateLike {
    /**
     * 喜爱人数
     */
    private int likeNum;

    /**
     * 喜爱时间
     */
    private Date likeTime;

    public int getLikeNum() {
        return likeNum;
    }

    public void setLikeNum(int likeNum) {
        this.likeNum = likeNum;
    }

    public Date getLikeTime() {
        return likeTime;
    }

    public void setLikeTime(Date likeTime) {
        this.likeTime = likeTime;
    }
}



public class Hall {
	private Integer id;
	private String name;
	private Integer row;
	private Integer column;
}

public class HallHasSchedule {


    private  Integer hallId;
        private Integer id;
        private String name;
        private Integer row;
        private Integer column;
    private Date date;


}


public class Movie {
	/**
	 * 电影id
	 */
	private Integer id;
	/**
	 * 电影名称
	 */
	private String name;
	/**
	 * 海报url
	 */
	private String posterUrl;
	/**
	 * 导演
	 */
	private String director;
	/**
	 * 编剧
	 */
	private String screenWriter;
	/**
	 * 主演
	 */
	private String starring;
	/**
	 * 电影类型
	 */
	private String type;
	/**
	 * 制片国家/地区
	 */
	private String country;
	/**
	 * 语言
	 */
	private String language;
	/**
	 * 上映时间
	 */
	private Date startDate;
	/**
	 * 片长
	 */
	private Integer length;
	/**
	 * 描述
	 * 
	 * @return
	 */
	private String description;
	/**
	 * 电影状态，0：上架状态，1：下架状态
	 */
	private Integer status;
	/**
	 * 是否想看,0:未标记想看，1：已标记想看
	 */
	private Integer islike;
	/**
	 * 想看人数
	 * 
	 * @return
	 */
	private Integer likeCount;

}


public class MoviePlacingRateByDate {
    private  Integer movieId;
    private String  name;
    //当天的放映次数
    private Integer scheduleTime;
    //当天的观影人数，也就是卖出去的票数
    private Integer ticketNumber;

}


public class MovieScheduleTime {
	private Integer movieId;
	/**
	 * 排片次数
	 */
	private Integer time;
	private String name;

}


public class MovieTotalBoxOffice {
    private Integer movieId;
    /**
     * 票房(单位：元)，(PS:如果后续数据量大，可自行处理单位，如改成单位：万元)
     */
    private Integer boxOffice;
    private String name;

    public Integer getMovieId() {
        return movieId;
    }

    public void setMovieId(Integer movieId) {
        this.movieId = movieId;
    }

    public Integer getBoxOffice() {
        return boxOffice;
    }

    public void setBoxOffice(Integer boxOffice) {
        this.boxOffice = boxOffice;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}


public class PopularMovies {
    private Integer movieId;
    private String name;
    private Integer boxOffice;
}

public class ScheduleItem {
	/**
	 * id
	 */
	private Integer id;
	/**
	 * 影厅id
	 */
	private Integer hallId;
	/**
	 * 影厅名称
	 */
	private String hallName;
	/**
	 * 电影id
	 */
	private Integer movieId;
	/**
	 * 电影名
	 */
	private String movieName;
	/**
	 * 开始放映时间
	 */
	private Date startTime;
	/**
	 * 结束放映时间
	 */
	private Date endTime;
	/**
	 * 票价
	 */
	private double fare;
}





public class Ticket {

	/**
	 * 电影票id
	 */
	private int id;
	/**
	 * 用户id
	 */
	private int userId;
	/**
	 * 排片id
	 */
	private int scheduleId;
	/**
	 * 列号
	 */
	private int columnIndex;
	/**
	 * 排号
	 */
	private int rowIndex;

	/**
	 * 订单状态： 0：未完成 1：已完成 2:已失效
	 */
	private int state;

	private Timestamp time;

	public Ticket() {
	}

	public TicketVO getVO() {
		TicketVO vo = new TicketVO();
		vo.setRowIndex(this.getRowIndex());
		vo.setColumnIndex(this.getColumnIndex());
		vo.setScheduleId(this.getScheduleId());
		vo.setId(this.getId());
		vo.setUserId(this.getUserId());
		String stateString;
		switch (state) {
		case 0:
			stateString = "未完成";
			break;
		case 1:
			stateString = "已完成";
			break;
		case 2:
			stateString = "已失效";
			break;
		default:
			stateString = "未完成";
		}
		vo.setState(stateString);
		vo.setTime(time);
		return vo;

	}

	public TicketWithScheduleVO getWithScheduleVO() {
		TicketWithScheduleVO vo = new TicketWithScheduleVO();
		vo.setRowIndex(this.getRowIndex());
		vo.setColumnIndex(this.getColumnIndex());
		vo.setId(this.getId());
		vo.setUserId(this.getUserId());
		String stateString;
		switch (state) {
		case 0:
			stateString = "未完成";
			break;
		case 1:
			stateString = "已完成";
			break;
		case 2:
			stateString = "已失效";
			break;
		default:
			stateString = "未完成";
		}
		vo.setState(stateString);
		return vo;
	}
}


public class TicketOrder {

    private int orderId;

    private int couponId;

    private List<Ticket> ticketList;

}


public class TicketRefund {

    /**
     * id
     */
    private int id;

    /**
     * 收取的手续费占实付款的比例
     */
    private Double rate;

    /**
     * 规定在电影放映多少小时之前可以退票
     */
    private Integer limitHours;

    public TicketRefundVO getVO(){
        TicketRefundVO vo = new TicketRefundVO();
        vo.setRate(rate);
        vo.setLimitHours(limitHours);
        return vo;
    }
}



public class User {
    private Integer id;
    private String username;
    private String password;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

}


public class VIPCard {

    /**
     * 用户id
     */
    private int userId;

    /**
     * 会员卡id
     */
    private int id;

    /**
     * 会员卡余额
     */
    private double balance;

    /**
     * 办卡日期
     */
    private Timestamp joinDate;

    public double calculate(double amount) {
        return (int) (amount / 200) * 30 + amount;
    }

}


public class VIPCardChargeHistory {

    private int id;

    private int userId;

    private double charge;

    private double balance;

    private Timestamp time;

    public VIPCardChargeHistoryVO getVO() {
        VIPCardChargeHistoryVO vo = new VIPCardChargeHistoryVO();
        vo.setCharge(charge);
        vo.setBalance(balance);
        vo.setTime(time);
        return vo;
    }
}

public class VIPInfo {

    private double price;

    private double charge;

    private double bonus;

    public VIPInfoVO getVO(){
        VIPInfoVO vo = new VIPInfoVO();
        vo.setCharge(charge);
        vo.setBonus(bonus);
        vo.setPrice(price);
        return vo;
    }
}

```

```java

```

```java

```

```java

```

```java

```

```java

```

```java

```